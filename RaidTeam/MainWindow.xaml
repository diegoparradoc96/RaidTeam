<?xml version="1.0" encoding="utf-8"?>

<Window
    x:Class="RaidTeam.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:RaidTeam.Converters"
    xmlns:models="using:RaidTeam.Models"
    mc:Ignorable="d"
    Title="RaidTeam - WoW TBC Raid Manager">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid">
        <Grid.Resources>
            <converters:NullToCollapsedConverter x:Key="NullToCollapsedConverter" />
            <converters:NullToVisibleConverter x:Key="NullToVisibleConverter" />
            <converters:PositionToRowConverter x:Key="PositionToRowConverter" />
            <converters:PositionToColumnConverter x:Key="PositionToColumnConverter" />
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <!--Panel izquierdo para lista de jugadores-->
            <ColumnDefinition Width="300" />
            <!--Panel central para grupos de raid-->
            <ColumnDefinition Width="*" />
            <!--Panel derecho para clases de WoW TBC-->
            <ColumnDefinition Width="250" />
        </Grid.ColumnDefinitions>

        <!--Panel Izquierdo - Lista de Jugadores-->
        <Border Grid.Column="0"
                Grid.Row="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8"
                Margin="10">
            <Grid Margin="20,20,20,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Título y Botones -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Players"
                              Style="{ThemeResource SubtitleTextBlockStyle}"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Left"
                              Grid.Column="0" />

                    <!-- Botón Agregar -->
                    <Button Grid.Column="1"
                            x:Name="AddPlayerButton"
                            Content="+"
                            Style="{ThemeResource AccentButtonStyle}"
                            Width="40"
                            Height="40"
                            CornerRadius="20"
                            FontSize="20"
                            FontWeight="Bold"
                            Margin="0,0,8,0"
                            ToolTipService.ToolTip="Agregar nuevo jugador"
                            Command="{Binding AddPlayerCommand}" />

                    <!-- Botón Filtro -->
                    <Button Grid.Column="2"
                            Width="40"
                            Height="40"
                            Padding="4"
                            Margin="0,0,0,0"
                            CornerRadius="4"
                            ToolTipService.ToolTip="Filtrar por clase"
                            RightTapped="FilterButton_RightTapped">
                        <Button.Flyout>
                            <Flyout Placement="Bottom">
                                <ScrollViewer MaxHeight="400" Padding="0,0,4,0">
                                    <StackPanel Margin="0,0,8,0">
                                        <!-- Warrior -->
                                        <StackPanel>
                                            <TextBlock Text="Warrior"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warrior Arms">
                                                    <Button.CommandParameter>
                                                        <x:String>Warrior Arms,ms-appx:///Assets/Warrior_Arms.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warrior_Arms.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warrior Fury">
                                                    <Button.CommandParameter>
                                                        <x:String>Warrior Fury,ms-appx:///Assets/Warrior_Fury.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warrior_Fury.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warrior Protection">
                                                    <Button.CommandParameter>
                                                        <x:String>Warrior Protection,ms-appx:///Assets/Warrior_Prot.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warrior_Prot.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Paladin -->
                                        <StackPanel>
                                            <TextBlock Text="Paladin"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Paladin Holy">
                                                    <Button.CommandParameter>
                                                        <x:String>Paladin Holy,ms-appx:///Assets/Paladin_Holy.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Paladin_Holy.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Paladin Protection">
                                                    <Button.CommandParameter>
                                                        <x:String>Paladin Protection,ms-appx:///Assets/Paladin_Prot.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Paladin_Prot.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Paladin Retribution">
                                                    <Button.CommandParameter>
                                                        <x:String>Paladin Retribution,ms-appx:///Assets/Paladin_Retri.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Paladin_Retri.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Hunter -->
                                        <StackPanel>
                                            <TextBlock Text="Hunter"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Hunter Beast Mastery">
                                                    <Button.CommandParameter>
                                                        <x:String>Hunter Beast Mastery,ms-appx:///Assets/Hunter_BM.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Hunter_BM.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Hunter Marksmanship">
                                                    <Button.CommandParameter>
                                                        <x:String>Hunter Marksmanship,ms-appx:///Assets/Hunter_MM.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Hunter_MM.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Hunter Survival">
                                                    <Button.CommandParameter>
                                                        <x:String>Hunter Survival,ms-appx:///Assets/Hunter_Survival.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Hunter_Survival.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Rogue -->
                                        <StackPanel>
                                            <TextBlock Text="Rogue"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Rogue Assassination">
                                                    <Button.CommandParameter>
                                                        <x:String>Rogue Assassination,ms-appx:///Assets/Rogue_Assassination.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Rogue_Assassination.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Rogue Combat">
                                                    <Button.CommandParameter>
                                                        <x:String>Rogue Combat,ms-appx:///Assets/Rogue_Combat.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Rogue_Combat.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Rogue Subtlety">
                                                    <Button.CommandParameter>
                                                        <x:String>Rogue Subtlety,ms-appx:///Assets/Rogue_Subtlety.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Rogue_Subtlety.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Priest -->
                                        <StackPanel>
                                            <TextBlock Text="Priest"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Priest Discipline">
                                                    <Button.CommandParameter>
                                                        <x:String>Priest Discipline,ms-appx:///Assets/Priest_Discipline.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Priest_Discipline.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Priest Holy">
                                                    <Button.CommandParameter>
                                                        <x:String>Priest Holy,ms-appx:///Assets/Priest_Holy.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Priest_Holy.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Priest Shadow">
                                                    <Button.CommandParameter>
                                                        <x:String>Priest Shadow,ms-appx:///Assets/Priest_Shadow.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Priest_Shadow.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Shaman -->
                                        <StackPanel>
                                            <TextBlock Text="Shaman"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Shaman Elemental">
                                                    <Button.CommandParameter>
                                                        <x:String>Shaman Elemental,ms-appx:///Assets/Shaman_Elemental.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Shaman_Elemental.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Shaman Enhancement">
                                                    <Button.CommandParameter>
                                                        <x:String>Shaman Enhancement,ms-appx:///Assets/Shaman_Enha.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Shaman_Enha.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Shaman Restoration">
                                                    <Button.CommandParameter>
                                                        <x:String>Shaman Restoration,ms-appx:///Assets/Shaman_Resto.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Shaman_Resto.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Mage -->
                                        <StackPanel>
                                            <TextBlock Text="Mage"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Mage Arcane">
                                                    <Button.CommandParameter>
                                                        <x:String>Mage Arcane,ms-appx:///Assets/Mage_Arcane.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Mage_Arcane.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Mage Fire">
                                                    <Button.CommandParameter>
                                                        <x:String>Mage Fire,ms-appx:///Assets/Mage_Fire.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Mage_Fire.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Mage Frost">
                                                    <Button.CommandParameter>
                                                        <x:String>Mage Frost,ms-appx:///Assets/Mage_Frost.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Mage_Frost.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Warlock -->
                                        <StackPanel>
                                            <TextBlock Text="Warlock"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warlock Affliction">
                                                    <Button.CommandParameter>
                                                        <x:String>Warlock Affliction,ms-appx:///Assets/Warlock_Affliction.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warlock_Affliction.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warlock Demonology">
                                                    <Button.CommandParameter>
                                                        <x:String>Warlock Demonology,ms-appx:///Assets/Warlock_Demonology.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warlock_Demonology.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Warlock Destruction">
                                                    <Button.CommandParameter>
                                                        <x:String>Warlock Destruction,ms-appx:///Assets/Warlock_Destruction.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Warlock_Destruction.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Druid -->
                                        <StackPanel>
                                            <TextBlock Text="Druid"
                                                      FontWeight="SemiBold"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5" />
                                            <StackPanel Orientation="Horizontal"
                                                      HorizontalAlignment="Center"
                                                      Margin="0,5">
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Druid Balance">
                                                    <Button.CommandParameter>
                                                        <x:String>Druid Balance,ms-appx:///Assets/Druid_Balance.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Druid_Balance.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Druid Feral">
                                                    <Button.CommandParameter>
                                                        <x:String>Druid Feral,ms-appx:///Assets/Druid_Feral.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Druid_Feral.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                                <Button Padding="4" Margin="2"
                                                        Command="{Binding FilterByRoleWithIconCommand}"
                                                        ToolTipService.ToolTip="Druid Restoration">
                                                    <Button.CommandParameter>
                                                        <x:String>Druid Restoration,ms-appx:///Assets/Druid_Resto.png</x:String>
                                                    </Button.CommandParameter>
                                                    <Image Source="ms-appx:///Assets/Druid_Resto.png"
                                                           Width="30"
                                                           Height="30" />
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </ScrollViewer>
                            </Flyout>
                        </Button.Flyout>

                        <!-- Ícono dinámico -->
                        <Grid>
                            <Image Source="ms-appx:///Assets/Band.png"
                                   Width="30"
                                   Height="30"
                                   Visibility="{Binding CurrentFilterIcon, Converter={StaticResource NullToVisibleConverter}}" />
                            <Image Source="{Binding CurrentFilterIcon}"
                                   Width="30"
                                   Height="30"
                                   Visibility="{Binding CurrentFilterIcon, Converter={StaticResource NullToCollapsedConverter}}" />
                        </Grid>
                    </Button>
                </Grid>

                <!-- TextBox para filtrar por nombre -->
                <TextBox Grid.Row="1"
                        PlaceholderText="Search player..."
                        Margin="0,8,0,0"
                        Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <!-- Lista de jugadores -->
                <ListView x:Name="PlayersListView"
                         Grid.Row="2"
                         Margin="0,8,0,0"
                         ItemsSource="{Binding Players}"
                         DragItemsStarting="PlayersListView_DragItemsStarting"
                         CanDragItems="True">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:Player">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <Image Source="{x:Bind IconPath}" Width="24" Height="24" />
                                    <TextBlock Text="{x:Bind Name}" VerticalAlignment="Center" />
                                </StackPanel>

                                <Button Grid.Column="1"
                                        Command="{Binding DataContext.DeletePlayerCommand, ElementName=PlayersListView}"
                                        CommandParameter="{x:Bind}"
                                        Style="{ThemeResource DateTimePickerFlyoutButtonStyle}"
                                        Width="32"
                                        Height="32"
                                        Padding="4"
                                        ToolTipService.ToolTip="Eliminar jugador">
                                    <FontIcon Glyph="&#xE711;" FontSize="12" />
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Border>

        <!--Panel Central - Grupos de Raid-->
        <Border Grid.Column="1"
                Grid.Row="0"
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                CornerRadius="8"
                Margin="5,10,5,10">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Auto">
                <StackPanel HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" 
                              HorizontalAlignment="Center"
                              Spacing="8"
                              Margin="0,10,0,20">
                        <TextBlock Text="{Binding RaidTeamName}"
                                 Style="{ThemeResource TitleTextBlockStyle}"
                                 VerticalAlignment="Center"/>
                        <Button Style="{ThemeResource DateTimePickerFlyoutButtonStyle}"
                                Command="{Binding EditRaidTeamNameCommand}"
                                Width="32"
                                Height="32"
                                Padding="4"
                                VerticalAlignment="Center"
                                ToolTipService.ToolTip="Editar nombre de la raid">
                            <FontIcon Glyph="&#xE70F;" FontSize="12"/>
                        </Button>
                    </StackPanel>
                    
                    <ItemsControl ItemsSource="{Binding Groups}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsWrapGrid Orientation="Horizontal"
                                             MaximumRowsOrColumns="3"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:Group">
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Margin="10"
                                        Padding="10"
                                        Width="200">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}"
                                                  Style="{ThemeResource SubtitleTextBlockStyle}"
                                                  HorizontalAlignment="Left"
                                                  Margin="0,0,0,10" />
                                        <ItemsControl ItemsSource="{Binding Slots}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="models:GroupSlot">
                                                    <Border Height="40"
                                                            Margin="0,2"
                                                            AllowDrop="True"
                                                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                            BorderThickness="1"
                                                            CornerRadius="4"
                                                            Drop="PlayerSlot_Drop"
                                                            DragOver="PlayerSlot_DragOver">
                                                        <Grid HorizontalAlignment="Stretch"
                                                              VerticalAlignment="Stretch">
                                                            <TextBlock Text=""
                                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"
                                                                       Visibility="{Binding Player, Converter={StaticResource NullToVisibleConverter}}" />
                                                            <Grid Margin="10,0"
                                                                  Visibility="{Binding Player, Converter={StaticResource NullToCollapsedConverter}}"
                                                                  HorizontalAlignment="Stretch"
                                                                  VerticalAlignment="Stretch"
                                                                  CanDrag="True"
                                                                  DragStarting="SlotPlayer_DragStarting">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="*" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <Image Source="{Binding Player.IconPath}"
                                                                       Width="24"
                                                                       Height="24"
                                                                       Grid.Column="0"
                                                                       VerticalAlignment="Center" />

                                                                <TextBlock Text="{Binding Player.Name}"
                                                                          Grid.Column="1"
                                                                          Margin="10,0"
                                                                          VerticalAlignment="Center" />

                                                                <Button Content="✖"
                                                                        Grid.Column="2"
                                                                        Width="28"
                                                                        Height="28"
                                                                        Padding="4"
                                                                        Command="{Binding DataContext.RemovePlayerFromSlotCommand, ElementName=RootGrid}"
                                                                        CommandParameter="{Binding}"
                                                                        ToolTipService.ToolTip="Retirar jugador del slot"
                                                                        VerticalAlignment="Center" />
                                                            </Grid>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!--Panel Derecho - Placeholder para clases-->
        <Border Grid.Column="2"
                Grid.Row="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8"
                Margin="10">
            <TextBlock Text=""
                      Style="{ThemeResource CaptionTextBlockStyle}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Opacity="0.6"
                      TextWrapping="Wrap" />
        </Border>
    </Grid>
</Window>